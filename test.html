<!DOCTYPE html>
<html>
<body>
    <video autoplay style="width:50%;height:50%"><source src="ext://hdmi:2"></video>
    <button onclick="startPoorCapture()">Start 10s "Recording"</button>
    <canvas id="stitcher" style="display:none"></canvas>
    <img id="preview" style="width:50%; border:2px solid red">

    <script src="webOSTVjs-1.1.1/webOSTV.js"></script>
    <script>
        let frames = [];
        let captureCount = 0;

        function startPoorCapture() {
            frames = [];
            captureCount = 0;
            const interval = setInterval(() => {
                if (captureCount >= 10) { // 10 frames over 10 seconds
                    clearInterval(interval);
                    playBack();
                    return;
                }
                
                // Luna call to capture HDMI pixels
                webOS.service.request("luna://com.webos.service.capture", {
                    method: "executeOneShot",
                    parameters: {
                        "path": `/tmp/frame_${captureCount}.jpg`,
                        "method": "SCREEN_WITH_SOURCE_VIDEO", // CRITICAL for HDMI
                        "format": "JPG",
                        "width": 640, "height": 360 // Lower res for "poor" quality
                    },
                    onSuccess: (res) => {
                        // In a real app, you'd fetch the file from /tmp via XHR/Fetch
                        frames.push(`/tmp/frame_${captureCount}.jpg`);
                        captureCount++;
                    }
                });
            }, 1000);
        }

        function playBack() {
            let i = 0;
            const img = document.getElementById('preview');
            setInterval(() => {
                img.src = frames[i % frames.length] + "?t=" + Date.now();
                i++;
            }, 500); // Playback at 2fps for that "poor" look
        }
    </script>
</body>
</html>
